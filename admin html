<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Eden Admin</title>
  <style>
    body{font-family:Inter,sans-serif;background:#f4fbf7;padding:2rem}
    form{display:flex;flex-direction:column;gap:1rem;max-width:400px}
    input,select,textarea{padding:.7rem;border:1px solid #ccc;border-radius:8px}
    #drop{border:2px dashed #a8e6cf;border-radius:16px;padding:2rem;text-align:center;cursor:pointer}
    #drop img{width:100%;border-radius:12px;margin-top:1rem}
    button{background:#a8e6cf;border:none;padding:.8rem;border-radius:12px;font-weight:600;cursor:pointer}
    .list{display:grid;grid-template-columns:repeat(auto-fill,140px);gap:1rem;margin-top:2rem}
    .item{background:#fff;border-radius:12px;padding:.5rem;text-align:center;position:relative}
    .item img{width:100%;height:100px;object-fit:cover;border-radius:8px}
    .item button{position:absolute;top:4px;right:4px;background:#ff6b6b;color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer}
  </style>
</head>
<body>
  <h2>–î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</h2>
  <form id="form">
    <input name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
    <input name="price" type="number" placeholder="–¶–µ–Ω–∞" required>
    <input name="kcal" type="number" placeholder="–ö–∞–ª–æ—Ä–∏–∏" required>
    <input name="ingr" placeholder="–°–æ—Å—Ç–∞–≤" required>
    <textarea name="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required></textarea>
    <select name="cat" required>
      <option value="healthy">ü•ó –ó–¥–æ—Ä–æ–≤–æ–µ</option>
      <option value="spicy">üå∂Ô∏è –û—Å—Ç—Ä–æ–µ</option>
      <option value="sushi">üç£ –°—É—à–∏</option>
      <option value="pasta">üçù –ü–∞—Å—Ç–∞</option>
      <option value="vegan">üå± –í–µ–≥–∞–Ω</option>
    </select>
    <div id="drop">–ü–µ—Ä–µ—Ç–∞—â–∏ —Ñ–æ—Ç–æ —Å—é–¥–∞<br><input type="file" accept="image/*" hidden name="img"></div>
    <button>–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
  </form>

  <h2>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ</h2>
  <div class="list" id="list"></div>

  <script>
    const drop = document.getElementById('drop');
    const fileInput = drop.querySelector('input');
    let file = null;

    drop.onclick = () => fileInput.click();
    fileInput.onchange = e => { file = e.target.files[0]; preview(file); };
    drop.ondragover = e => e.preventDefault();
    drop.ondrop = e => { e.preventDefault(); file = e.dataTransfer.files[0]; fileInput.files = e.dataTransfer.files; preview(file); };

    function preview(f) {
      const img = new Image();
      img.src = URL.createObjectURL(f);
      drop.appendChild(img);
    }

    document.getElementById('form').onsubmit = async (e) => {
      e.preventDefault();
      if (!file) return alert('–î–æ–±–∞–≤—å —Ñ–æ—Ç–æ');
      const form = new FormData(e.target);
      form.set('img', file);
      await fetch('/api/dishes', { method: 'POST', body: form });
      e.target.reset();
      drop.querySelector('img')?.remove();
      file = null;
      load();
    };

    async function load() {
      const res = await fetch('/api/dishes');
      const dishes = await res.json();
      const list = document.getElementById('list');
      list.innerHTML = dishes.map(d => `
        <div class="item">
          <img src="${d.img}" alt="">
          <div>${d.name}</div>
          <button onclick="del(${d.id})">√ó</button>
        </div>
      `).join('');
    }
    async function del(id) {
      await fetch('/api/dishes/' + id, { method: 'DELETE' });
      load();
    }
    load();
  </script>
</body>
</html>
